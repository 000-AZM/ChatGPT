<h2>My Profile</h2>
<div id="profileView">
  <p><b>Email:</b> <span id="emailDisplay"></span></p>
  <p><b>Username:</b> <span id="usernameDisplay"></span></p>
  <button id="editProfileBtn">Edit</button>
</div>

<div id="profileEdit" style="display:none;">
  <input id="usernameInput" placeholder="New Username" />
  <button id="saveProfileBtn">Save</button>
  <button onclick="location.reload()">Cancel</button>
</div>

<script type="module">
  import { auth, db } from './firebase.js';
  import { doc, getDoc, updateDoc } from 'firebase/firestore';

  auth.onAuthStateChanged(async user => {
    if (!user) return location = 'index.html';

    const userDoc = await getDoc(doc(db, "users", user.uid));
    const data = userDoc.data();
    document.getElementById("emailDisplay").innerText = user.email;
    document.getElementById("usernameDisplay").innerText = data.username;

    document.getElementById("editProfileBtn").onclick = () => {
      document.getElementById("profileView").style.display = "none";
      document.getElementById("profileEdit").style.display = "block";
      document.getElementById("usernameInput").value = data.username;
    };

    document.getElementById("saveProfileBtn").onclick = async () => {
      await updateDoc(doc(db, "users", user.uid), {
        username: document.getElementById("usernameInput").value
      });
      alert("Profile updated");
      location.reload();
    };
  });
</script>
