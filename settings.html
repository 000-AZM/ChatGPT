<h2>Settings</h2>
<button onclick="changePassword()">Change Password</button>
<br /><br />
<button onclick="deleteAccount()">Delete Account</button>

<script type="module">
  import { auth, db } from './firebase.js';
  import { deleteUser, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from "firebase/auth";
  import { doc, deleteDoc } from "firebase/firestore";

  auth.onAuthStateChanged(user => {
    if (!user) location = "index.html";
  });

  window.changePassword = () => {
    const newPassword = prompt("Enter new password");
    if (!newPassword) return;
    updatePassword(auth.currentUser, newPassword)
      .then(() => alert("Password updated"))
      .catch(err => alert("Error: " + err.message));
  };

  window.deleteAccount = async () => {
    if (!confirm("Are you sure? This cannot be undone.")) return;
    try {
      await deleteDoc(doc(db, "users", auth.currentUser.uid));
      await deleteUser(auth.currentUser);
      alert("Account deleted");
      location = "index.html";
    } catch (err) {
      alert("Error: " + err.message);
    }
  };
</script>
